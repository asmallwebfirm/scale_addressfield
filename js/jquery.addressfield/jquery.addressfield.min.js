/*! Address Field - v1.0.0 - 2014-09-24
* https://github.com/tableau-mkt/jquery.addressfield
* Copyright (c) 2014 Eric Peterson; Licensed GPL-2.0 */
!function(a){a.fn.addressfield=function(b,c){var d,e,f,g,h=a(this),i=[];for(f in b.fields){if(g=a.fn.addressfield.onlyKey(b.fields[f]),d=h.find("."+g),b.fields[f][g]instanceof Array)return a.fn.addressfield.call(d,{fields:b.fields[f][g]},c);d.length&&-1!==a.inArray(g,c)&&(i.push(g),"undefined"!=typeof b.fields[f][g].options?(d.is("select")||(d=a.fn.addressfield.convertToSelect.call(d)),a.fn.addressfield.updateOptions.call(d,b.fields[f][g].options)):(d.is("select")&&(d=a.fn.addressfield.convertToText.call(d)),e=b.fields[f][g].hasOwnProperty("eg")?b.fields[f][g].eg:"",a.fn.addressfield.updateEg.call(d,e)),a.fn.addressfield.updateLabel.call(d,b.fields[f][g].label)),a.fn.addressfield.isVisible.call(d)||-1===a.inArray(g,c)||a.fn.addressfield.showField.call(d),a.fn.addressfield.validate.call(d,g,b.fields[f][g])}return a.each(c,function(c,d){var e=h.find("."+d);e.length&&!a.fn.addressfield.hasField(b,d)&&a.fn.addressfield.hideField.call(e)}),a.fn.addressfield.orderFields.call(h,i),this},a.fn.addressfield.onlyKey=function(a){for(var b in a)return b},a.fn.addressfield.hasField=function(b,c){var d,e;for(d in b.fields){if(e=a.fn.addressfield.onlyKey(b.fields[d]),b.fields[d][e]instanceof Array)return a.fn.addressfield.hasField({fields:b.fields[d][e]},c);if(e===c)return!0}return!1},a.fn.addressfield.updateLabel=function(b){var c=a(this),d=c.attr("id"),e=a('label[for="'+d+'"]')||c.prev("label");e.text(b)},a.fn.addressfield.updateEg=function(b){var c=b?"e.g. "+b:"";a(this).attr("placeholder",c)},a.fn.addressfield.updateOptions=function(b){var c=a(this),d=c.data("_saved")||c.val();c.children("option").remove(),a.each(b,function(d){var e=a.fn.addressfield.onlyKey(b[d]);c.append(a("<option></option>").attr("value",e).text(b[d][e]))}),c.val(d).change(),c.removeData("_saved")},a.fn.addressfield.convertToText=function(){var b=a(this),c=a("<input />").attr("type","text");return a.fn.addressfield.copyAttrsTo.call(b,c),c.val(b.val()),b.replaceWith(c),c},a.fn.addressfield.convertToSelect=function(){var b=a(this),c=a("<select></select>");return a.fn.addressfield.copyAttrsTo.call(b,c),c.data("_saved",b.val()),b.replaceWith(c),c},a.fn.addressfield.validate=function(b,c){var d=a(this),e="isValid_"+b,f={},g="Please check your formatting.";"undefined"!=typeof a.validator&&(g=a.validator.messages.hasOwnProperty(e)?a.validator.messages[e]:g,c.hasOwnProperty("format")?(a.validator.addMethod(e,function(a){return new RegExp(c.format).test(a)},g),f[e]=!0,d.rules("add",f)):a.validator.addMethod(e,function(){return!0},g))},a.fn.addressfield.hideField=function(){a(this).val("").hide(),a.fn.addressfield.container.call(this).hide()},a.fn.addressfield.showField=function(){this.show(),a.fn.addressfield.container.call(this).show()},a.fn.addressfield.isVisible=function(){return a(this).is(":visible")},a.fn.addressfield.container=function(){var b=a(this),c=b.attr("id"),d=a('label[for="'+c+'"]')||b.prev("label");return"function"==typeof a.fn.has?b.parents().has(d).first():b.parents().find(":has(label):has(#"+c+"):last")},a.fn.addressfield.copyAttrsTo=function(b){var c=["class","id","name"],d=a(this);a.each(d[0].attributes,function(){-1!==a.inArray(this.name,c)&&b.attr(this.name,this.value)})},a.fn.addressfield.orderFields=function(b){var c,d,e=b.length;for(c=0;e>c;++c)c in b&&(d=a.fn.addressfield.container.call(this.find("."+b[c])),b[c]={element:d.clone(),"class":b[c],value:a(this).find("."+b[c]).val()},d.remove());for(c=0;e>c;++c)c in b&&(d=a(this).append(b[c].element),d.find("."+b[c]["class"]).val(b[c].value).change())}}(jQuery);